### 什么是RabbitMQ?
采用AMQP高级消息队列协议的一种消息队列技术，最大的特点就是消费不需要确保提供方存在，实现服务之间的高度解耦

### 为什么使用RabbitMQ（优点）
1. 在分布式系统下具备异步、削峰、负载均衡等一系列的高级功能
2. 拥有持久性的机制，进程消息，队列中的信息也可以保存下来
3. 实现消费者和生产者之间的解耦
4. 对于高并发情况下，利用消息队列可以使得同步访问变为串行访问
5. 可以使用消息队列达到异步下单的效果，排队后，后天进行逻辑下单

### 什么场景下使用RabbitMQ
1. 服务间异步通信
2. 顺序消费
3. 定时任务
4. 请求削峰

### 如何确保正确的发送至RabbitMQ？如何确保消息接收方消费了消息？
* 发送确认模式
1. 将信道设置成confirm模式（发送确认模式），则所有在信道上发布的消息都会被指派一个唯一的ID。
2. 一旦消息被投递到目的队列后，或者消息被写入磁盘后，信道会发送一个确认给生产者。
3. 如果RabbitMQ发生内部错误从而导致消息丢失，会发送一条nack（not acknowledge, 未确认）消息。
4. 发送方确认模式是异步的，生产者应用程序在等待确认的同时，可以继续发送消息。当确认消息到达生产者应用程序，生产者应用程序的回调方法会被触发来处理确认消息。

* 接收方消息确认机制
1. 消费者接收每一条消息后都需要进行确认，只有确认了消息，RabbitMQ才会把消息在队列中删除。
2. 如果消费者接收到，在确认之前断开了连接，RabbitMQ会认为该消息没被消费，会重新分发给笑一个订阅的消费者。
3. 如果消费者收到消息却没有确认消息，连接也未断开，则RabbitMQ认为该消费者繁忙，将不会给消费者分发更多的消息。


### 消息怎么路由？
消息提供方--> 路由 --> 一至多个队列

消息发布到交换器时，消息将拥有一个路由键，在消息创建时设定。通过队列路由键，可以把队列绑定到交换机上。
消息到达交换机后，RabbitMQ会将消息的路由键与队列的路由键及逆行匹配。

### 常用的交换机有哪些？

* fanout：如果交换机收到消息，将会广播到所有绑定的队列上
* direct：如果路由键完全匹配，消息就被投递到相应的队列
* topic：可以使用不同源头的消息能够到达同一队列。使用topic交换器时，可以使用通配符

### MQ的缺点

1. 系统复杂度增高
2. 系统一致性问题
3. 系统可用性降低